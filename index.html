<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Folder Tree to ZIP</title>
    <!-- Use a reliable CDN for JSZip -->
    <script src="cdnjs.cloudflare.com"></script>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; }
        textarea { width: 100%; height: 250px; font-family: monospace; border: 1px solid #ccc; padding: 10px; }
        button { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; }
        button:hover { background: #0056b3; }
        pre { background: #f4f4f4; padding: 10px; font-size: 0.8rem; color: #555; }
    </style>
</head>
<body>
    <h2>Text Tree to ZIP</h2>
    <p>Paste your folder structure below. Use indentation to show nesting.</p>
    <textarea id="treeInput" placeholder="project/
  src/
    main.js
  README.md"></textarea>
    
    <button id="downloadBtn">Download actual .zip</button>

    <script>
        document.getElementById('downloadBtn').addEventListener('click', async () => {
            const zip = new JSZip();
            const text = document.getElementById('treeInput').value;
            const lines = text.split('\n').filter(l => l.trim() !== "");
            
            // Path tracker based on indentation level
            let pathStack = [];

            lines.forEach(line => {
                // 1. Calculate leading spaces to determine depth
                const indentMatch = line.match(/^(\s*)/);
                const indent = indentMatch ? indentMatch[0].length : 0;
                
                // 2. Clean the name (remove tree symbols if present)
                let name = line.trim().replace(/^([├└─│]\s*)+/, "");

                // 3. Determine level (assumes 2 or 4 spaces per level)
                // We use a simple heuristic: level = indentation depth
                const level = indent; 

                // Reset stack to the current depth
                // This ensures that a decrease in indentation pops parents correctly
                pathStack = pathStack.filter(p => p.indent < indent);
                
                // Construct the full path
                const parentPath = pathStack.map(p => p.name).join('/');
                const fullPath = parentPath ? `${parentPath}/${name}` : name;

                // 4. Add to ZIP
                if (name.endsWith('/') || !name.includes('.')) {
                    // It's a folder
                    zip.folder(fullPath);
                    pathStack.push({ name, indent });
                } else {
                    // It's a file
                    zip.file(fullPath, "Generated by Text-to-ZIP tool.");
                }
            });

            try {
                // 5. Generate and trigger download
                const blob = await zip.generateAsync({ type: "blob" });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = "directory_structure.zip";
                document.body.appendChild(a);
                a.click();
                
                // Cleanup
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } catch (err) {
                alert("Error generating ZIP: " + err.message);
            }
        });
    </script>
</body>
</html>
